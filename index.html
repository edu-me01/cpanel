<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Task Manager</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link href="css/style.css" rel="stylesheet" />
    <style>
      .login-container {
        min-height: 100vh;
        background: linear-gradient(
          135deg,
          var(--bg-primary) 0%,
          var(--bg-secondary) 100%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-lg);
      }

      .login-card {
        background-color: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        max-width: 450px;
        width: 100%;
        overflow: hidden;
      }

      .login-header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-hover)
        );
        padding: var(--spacing-xl);
        text-align: center;
        color: white;
      }

      .login-header .brand-icon {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--spacing-lg);
        font-size: 2rem;
      }

      .login-header h2 {
        margin-bottom: var(--spacing-sm);
        font-weight: 600;
      }

      .login-header p {
        opacity: 0.9;
        margin: 0;
      }

      .login-body {
        padding: var(--spacing-xl);
      }

      .user-type-selector {
        display: flex;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-lg);
      }

      .user-type-btn {
        flex: 1;
        padding: var(--spacing-md);
        border: 2px solid var(--border-color);
        background: none;
        color: var(--text-secondary);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all var(--transition-fast);
        font-weight: 500;
      }

      .user-type-btn.active {
        border-color: var(--primary-color);
        background-color: var(--primary-color);
        color: white;
      }

      .user-type-btn:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      .user-type-btn.active:hover {
        color: white;
      }

      .login-form {
        display: none;
      }

      .login-form.active {
        display: block;
      }

      .form-floating {
        margin-bottom: var(--spacing-md);
      }

      .form-control {
        background-color: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        color: var(--text-primary);
        padding: var(--spacing-md);
      }

      .form-control:focus {
        background-color: var(--bg-tertiary);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        color: var(--text-primary);
      }

      .form-floating label {
        color: var(--text-muted);
      }

      .login-btn {
        width: 100%;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-hover)
        );
        border: none;
        border-radius: var(--radius-lg);
        padding: var(--spacing-md);
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-fast);
        margin-top: var(--spacing-md);
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        color: white;
      }

      .login-footer {
        text-align: center;
        margin-top: var(--spacing-lg);
        padding-top: var(--spacing-lg);
        border-top: 1px solid var(--border-color);
      }

      .login-footer a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
      }

      .login-footer a:hover {
        text-decoration: underline;
      }

      .error-message {
        background-color: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--danger-color);
        border-radius: var(--radius-md);
        padding: var(--spacing-md);
        color: var(--danger-color);
        margin-bottom: var(--spacing-md);
        display: none;
      }

      .success-message {
        background-color: rgba(16, 185, 129, 0.1);
        border: 1px solid var(--success-color);
        border-radius: var(--radius-md);
        padding: var(--spacing-md);
        color: var(--success-color);
        margin-bottom: var(--spacing-md);
        display: none;
      }

      .demo-credentials {
        background-color: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: var(--spacing-md);
        margin-top: var(--spacing-lg);
      }

      .demo-credentials h6 {
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
      }

      .demo-credentials p {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: var(--spacing-xs);
      }
    </style>
  </head>
  <body class="modern-theme">
    <div class="login-container">
      <div class="login-card">
        <div class="login-header">
          <div class="brand-icon">
            <i class="fas fa-tasks"></i>
          </div>
          <h2>Task Manager</h2>
          <p>Welcome back! Please sign in to your account.</p>
        </div>

        <div class="login-body">
          <!-- User Type Selector -->
          <div class="user-type-selector">
            <button class="user-type-btn active" data-type="student">
              <i class="fas fa-user-graduate me-2"></i>
              Student
            </button>
            <button class="user-type-btn" data-type="admin">
              <i class="fas fa-user-shield me-2"></i>
              Admin
            </button>
          </div>

          <!-- Error/Success Messages -->
          <div class="error-message" id="errorMessage"></div>
          <div class="success-message" id="successMessage"></div>

          <!-- Student Login Form -->
          <form class="login-form active" id="studentLoginForm">
            <div class="form-floating">
              <input
                type="email"
                class="form-control"
                id="studentEmail"
                placeholder="Email"
                required
              />
              <label for="studentEmail">Student Email</label>
            </div>
            <div class="form-floating">
              <input
                type="password"
                class="form-control"
                id="studentPassword"
                placeholder="Password"
                required
              />
              <label for="studentPassword">Password</label>
            </div>
            <button type="submit" class="login-btn">
              <i class="fas fa-sign-in-alt me-2"></i>
              Login as Student
            </button>
          </form>

          <!-- Admin Login Form -->
          <form class="login-form" id="adminLoginForm">
            <div class="form-floating">
              <input
                type="email"
                class="form-control"
                id="adminEmail"
                placeholder="Email"
                required
              />
              <label for="adminEmail">Admin Email</label>
            </div>
            <div class="form-floating">
              <input
                type="password"
                class="form-control"
                id="adminPassword"
                placeholder="Password"
                required
              />
              <label for="adminPassword">Password</label>
            </div>
            <button type="submit" class="login-btn">
              <i class="fas fa-user-shield me-2"></i>
              Login as Admin
            </button>
          </form>

          <!-- Demo Credentials -->
          <div class="demo-credentials">
            <h6><i class="fas fa-info-circle me-2"></i>Demo Credentials</h6>
            <p><strong>Student:</strong> student@school.com / student123</p>
            <p><strong>Admin:</strong> admin@school.com / admin123</p>
          </div>

          <div class="login-footer">
            <p>
              Don't have an account? <a href="register.html">Register here</a>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Message Container -->
    <div id="message" class="alert mt-3" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;"></div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="js/session-tracker.js"></script>
    <script>
      // Check if user is already logged in
      document.addEventListener("DOMContentLoaded", () => {
        const token = sessionStorage.getItem("token");
        const userType = sessionStorage.getItem("userType");

        if (token && userType) {
          // User is already logged in, redirect to appropriate dashboard
          if (userType === "admin") {
            window.location.href = "Admin-dashboard.html";
          } else if (userType === "student") {
            window.location.href = "student-dashboard.html";
          }
        }
      });

      // User type selector
      document.querySelectorAll("[data-type]").forEach((button) => {
        button.addEventListener("click", (e) => {
          e.preventDefault();
          const type = button.dataset.type;

          // Update active state
          document
            .querySelectorAll("[data-type]")
            .forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");

          // Show appropriate form
          document
            .querySelectorAll(".login-form")
            .forEach((form) => (form.style.display = "none"));
          document.getElementById(type + "LoginForm").style.display = "block";

          // Update form title
          document.getElementById("formTitle").textContent =
            type === "admin" ? "Admin Login" : "Student Login";
        });
      });

      // Auto-fill demo credentials
      function autoFillCredentials(type) {
        if (type === "admin") {
          document.getElementById("adminEmail").value = "admin@school.com";
          document.getElementById("adminPassword").value = "admin123";
        } else {
          document.getElementById("studentEmail").value = "student@school.com";
          document.getElementById("studentPassword").value = "student123";
        }
      }

      // Show message function
      function showMessage(message, type = "info") {
        const messageDiv = document.getElementById("message");
        if (!messageDiv) {
          // Fallback: create a temporary message element
          const tempDiv = document.createElement("div");
          tempDiv.className = `alert alert-${type === "error" ? "danger" : type} alert-dismissible fade show position-fixed`;
          tempDiv.style.cssText = "top: 20px; right: 20px; z-index: 9999; min-width: 300px;";
          tempDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          `;
          document.body.appendChild(tempDiv);
          
          setTimeout(() => {
            if (tempDiv.parentNode) {
              tempDiv.parentNode.removeChild(tempDiv);
            }
          }, 5000);
          return;
        }

        messageDiv.textContent = message;
        messageDiv.className = `alert alert-${type === "error" ? "danger" : type} alert-dismissible fade show`;
        messageDiv.style.display = "block";

        setTimeout(() => {
          messageDiv.style.display = "none";
        }, 5000);
      }

      // Admin login form
      document
        .getElementById("adminLoginForm")
        .addEventListener("submit", (e) => {
          e.preventDefault();

          const email = document.getElementById("adminEmail").value;
          const password = document.getElementById("adminPassword").value;

          // Simple validation
          if (!email || !password) {
            showMessage("Please fill in all fields", "error");
            return;
          }

          // Check admin credentials
          if (email === "admin@school.com" && password === "admin123") {
            // Generate a simple token (in production, this would come from backend)
            const token = "admin_token_" + Date.now();
            const userData = {
              id: "admin_001",
              type: "admin",
              name: "Administrator",
              email: email,
            };

            // Store authentication data
            sessionStorage.setItem("token", token);
            sessionStorage.setItem("userType", "admin");
            sessionStorage.setItem("userEmail", email);
            sessionStorage.setItem("userData", JSON.stringify(userData));

            // Track admin session
            sessionTracker.addSession(userData);

            showMessage("Login successful! Redirecting...", "success");

            // Redirect to admin dashboard
            setTimeout(() => {
              window.location.href = "Admin-dashboard.html";
            }, 1000);
          } else {
            showMessage("Invalid credentials", "error");
          }
        });

      // Student login form
      document
        .getElementById("studentLoginForm")
        .addEventListener("submit", (e) => {
          e.preventDefault();

          const email = document.getElementById("studentEmail").value;
          const password = document.getElementById("studentPassword").value;

          // Simple validation
          if (!email || !password) {
            showMessage("Please fill in all fields", "error");
            return;
          }

          // Check student credentials
          if (email === "student@school.com" && password === "student123") {
            // Generate a simple token (in production, this would come from backend)
            const token = "student_token_" + Date.now();
            const userData = {
              id: "student_001",
              type: "student",
              name: "John Student",
              email: email,
            };

            // Store authentication data
            sessionStorage.setItem("token", token);
            sessionStorage.setItem("userType", "student");
            sessionStorage.setItem("userEmail", email);
            sessionStorage.setItem("userData", JSON.stringify(userData));

            // Track student session
            sessionTracker.addSession(userData);

            showMessage("Login successful! Redirecting...", "success");

            // Redirect to student dashboard
            setTimeout(() => {
              window.location.href = "student-dashboard.html";
            }, 1000);
          } else {
            showMessage("Invalid credentials", "error");
          }
        });

      // Add click handlers to demo credentials
      document.addEventListener("DOMContentLoaded", () => {
        const demoCreds = document.querySelector(".demo-credentials");
        demoCreds.addEventListener("click", (e) => {
          if (e.target.textContent.includes("Student:")) {
            autoFillCredentials("student");
            // Switch to student form
            document.querySelector('[data-type="student"]').click();
          } else if (e.target.textContent.includes("Admin:")) {
            autoFillCredentials("admin");
            // Switch to admin form
            document.querySelector('[data-type="admin"]').click();
          }
        });

        // Add logout function for testing
        window.logout = function () {
          const sessionId = sessionStorage.getItem("currentSessionId");
          if (sessionId) {
            sessionTracker.removeSession(sessionId);
          }
          sessionStorage.removeItem("token");
          sessionStorage.removeItem("userType");
          sessionStorage.removeItem("userEmail");
          sessionStorage.removeItem("userData");
          sessionStorage.removeItem("currentSessionId");
          window.location.href = "index.html";
        };
      });
    </script>
  </body>
</html>
